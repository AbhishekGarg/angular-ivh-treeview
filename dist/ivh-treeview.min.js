angular.module("ivh.treeview",[]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",["$timeout",function(a){"use strict";return{link:function(b,c,d){var e=b.$eval(d.ivhTreeviewCheckbox),f=d.ivhTreeviewIndeterminateAttribute;c.bind("change",function(){b.$broadcast("event_ivhTreeviewSelectAll",c.prop("checked")),a(function(){b.$parent.$emit("event_ivhTreeviewValidate")})}),c.bind("click",function(a){var b=e[f];b&&(c.prop("checked",!1),a.preventDefault(),a.stopImmediatePropagation())});var g=function(){a(function(){var a=e.__ivhTreeviewIntermediate;c.prop("indeterminate",a)})},h=function(){c.prop("indeterminate",!1)};b.$on("event_ivhTreeviewValidate",g),b.$on("event_ivhTreeviewSelectAll",h)}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNode",["$compile",function(){"use strict";return{restrict:"A",link:function(a,b,c){var d=c.ivhTreeviewNode,e=c.ivhTreeviewFilter,f=c.ivhTreeviewNodeVisibleAttribute,g=a.$eval(c.ivhTreeviewNode);if(!e||"undefined"===e)return void(g[f]=!0);var h=Array.prototype.map||function(a){var b=[];return angular.forEach(this,function(c){b.push(a(c))}),b},i=h.call(e.split("|"),function(a){var b=a.split(":");return b}),j=[];angular.forEach(i,function(a){Array.prototype.push.apply(j,a.slice(1))});var k="["+d+"] | "+e,l=function(){var b=a.$eval(k);g[f]=b.length>0};angular.forEach(j,function(b){a.$watch(b,l)})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNodeToggle",["$timeout",function(){"use strict";return{restrict:"A",link:function(a,b,c){for(var d=(a.$eval(c.ivhTreeviewNodeToggle),b.parent());d&&"LI"!==d.prop("nodeName");)d=d.parent();b.bind("click",function(){d.hasClass("ivh-treeview-node-leaf")||d.toggleClass("ivh-treeview-node-collapsed")})}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["$compile","$filter","ivhTreeviewSettings",function(a,b,c){"use strict";return{restrict:"A",link:function(d,e,f){var g=c.get(),h=f.ivhTreeview,i=f.ivhTreeviewFilter,j=d.$eval(f.ivhTreeviewLabelAttribute)||g.labelAttribute,k=d.$eval(f.ivhTreeviewChildrenAttribute)||g.childrenAttribute,l=d.$eval(f.ivhTreeviewSelectedAttribute)||g.selectedAttribute,m=f.ivhTreeviewIndeterminateAttribute||g.indeterminateAttribute,n=f.ivhTreeviewVisibleAttribute||g.visibleAttribute,o=angular.isDefined(f.ivhTreeviewUseCheckboxes)?d.$eval(f.ivhTreeviewUseCheckboxes):g.useCheckboxes,p=b("ivhTreeviewAsArray"),q=function(){return p(d.$eval(h))},r=function(){return d.$eval(f.ivhTreeviewParent)},s=["<input",'ivh-treeview-checkbox="itm"','ivh-treeview-indeterminate-attribute="'+m+']"','class="ivh-treeview-checkbox"','type="checkbox"',"ng-model=\"itm['"+l+"']\" />"].join("\n"),t=['<ul class="ivh-treeview">','<li ng-repeat="itm in '+h+' | ivhTreeviewAsArray"',"ng-class=\"{'ivh-treeview-node-leaf': !itm['"+k+"'].length, 'ivh-treeview-node-collapsed': itm['"+k+"'].length}\"",'ivh-treeview-node="itm"','ivh-treeview-node-visible-attribute="'+n+'"','ivh-treeview-node-hook="itm"','ivh-treeview-filter="'+i+'"','ng-show="itm.'+n+'">','<div ivh-treeview-node-hook class="ivh-treeview-node">','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-right glyphicon glyphicon-chevron-right"></span>','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-down glyphicon glyphicon-chevron-down"></span>','<span class="ivh-treeview-toggle ivh-treeview-toggle-leaf">&#9679;</span>',o?s:"",'<span ivh-treeview-node-toggle="true" class="ivh-treeview-node-label">',"{{itm."+j+"}}","</span>","</div>","<div","ivh-treeview=\"itm['"+k+"']\"",'ivh-treeview-parent="itm"',i?'ivh-treeview-filter="'+i+'"':"",'ivh-treeview-label-attribute="'+j+'"','ivh-treeview-children-attribute="'+k+'"','ivh-treeview-selected-attribute="'+l+'"','ivh-treeview-visible-attribute="'+n+'"','ivh-treeview-use-checkboxes="'+o+'"',"></div>","</li>","</ul>"].join("\n"),u=function(){var b=q();if(b&&b.length){var c=a(t)(d);e.html("").append(c)}};d.$watch(f.ivhTreeview,u),d.$on("event_ivhTreeviewSelectAll",function(a,b){var c=q(),d=r();angular.forEach(c,function(a){a[l]=b,a[m]=!1}),d&&(d[l]=b,d[m]=!1)}),d.$on("event_ivhTreeviewValidate",function(){var a=q(),b=r(),c=a.length,d=0,e=0;a&&a.length&&b&&(angular.forEach(a,function(a){a[l]&&d++,a[m]&&e++}),0===d?(b[l]=!1,b[m]=!!e):d===c?(b[l]=!0,b[m]=!1):(b[l]=!1,b[m]=!0))})}}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(a){return!angular.isArray(a)&&angular.isObject(a)?[a]:a}}),angular.module("ivh.treeview").provider("ivhTreeviewSettings",function(){"use strict";var a={labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandByDefaultDepth:0,useCheckboxes:!0,indeterminateAttribute:"__ivhTreeviewIntermediate",visibleAttribute:"__ivhTreeviewVisible"};this.set=function(b){angular.extend(a,b)},this.$get=function(){return{get:function(){return angular.copy(a)}}}});