angular.module("ivh.treeview",[]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",["$timeout",function(a){"use strict";return{link:function(b,c,d){var e=b.$eval(d.ivhTreeviewCheckbox),f=d.ivhTreeviewIndeterminateAttribute;c.bind("change",function(){b.$broadcast("event_ivhTreeviewSelectAll",c.prop("checked")),a(function(){b.$parent.$emit("event_ivhTreeviewValidate")})}),c.bind("click",function(a){var b=e[f];b&&(c.prop("checked",!1),a.preventDefault(),a.stopImmediatePropagation())});var g=function(){a(function(){var a=e.__ivhTreeviewIntermediate;c.prop("indeterminate",a)})},h=function(){c.prop("indeterminate",!1)};b.$on("event_ivhTreeviewValidate",g),b.$on("event_ivhTreeviewSelectAll",h)}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNode",["$compile",function(){"use strict";return{restrict:"A",link:function(a,b,c){var d=c.ivhTreeviewNode,e=c.ivhTreeviewFilter,f=c.ivhTreeviewNodeVisibleAttribute,g=a.$eval(c.ivhTreeviewNode);if(!e||"undefined"===e)return void(g[f]=!0);var h=Array.prototype.map||function(a){var b=[];return angular.forEach(this,function(c){b.push(a(c))}),b},i=h.call(e.split("|"),function(a){var b=a.split(":");return b}),j=[];angular.forEach(i,function(a){Array.prototype.push.apply(j,a.slice(1))});var k="["+d+"] | "+e,l=function(){var b=a.$eval(k);g[f]=b.length>0};angular.forEach(j,function(b){a.$watch(b,l)})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNodeToggle",["$timeout",function(){"use strict";return{restrict:"A",link:function(a,b,c){for(var d=(a.$eval(c.ivhTreeviewNodeToggle),b.parent());d&&"LI"!==d.prop("nodeName");)d=d.parent();b.bind("click",function(){d.hasClass("ivh-treeview-node-leaf")||d.toggleClass("ivh-treeview-node-collapsed")})}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["$compile","ivhTreeviewSettings",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){var f=b.get(),g=e.ivhTreeview,h=e.ivhTreeviewFilter,i=c.$eval(e.ivhTreeviewLabelAttribute)||f.labelAttribute,j=c.$eval(e.ivhTreeviewChildrenAttribute)||f.childrenAttribute,k=c.$eval(e.ivhTreeviewSelectedAttribute)||f.selectedAttribute,l=e.ivhTreeviewIndeterminateAttribute||f.indeterminateAttribute,m=e.ivhTreeviewVisibleAttribute||f.visibleAttribute,n=angular.isDefined(e.ivhTreeviewUseCheckboxes)?c.$eval(e.ivhTreeviewUseCheckboxes):f.useCheckboxes,o=function(){return c.$eval(g)},p=function(){return c.$eval(e.ivhTreeviewParent)},q=["<input",'ivh-treeview-checkbox="itm"','ivh-treeview-indeterminate-attribute="'+l+']"','class="ivh-treeview-checkbox"','type="checkbox"',"ng-model=\"itm['"+k+"']\" />"].join("\n"),r=['<ul class="ivh-treeview">','<li ng-repeat="itm in '+g+'"',"ng-class=\"{'ivh-treeview-node-leaf': !itm['"+j+"'].length, 'ivh-treeview-node-collapsed': itm['"+j+"'].length}\"",'ivh-treeview-node="itm"','ivh-treeview-node-visible-attribute="'+m+'"','ivh-treeview-node-hook="itm"','ivh-treeview-filter="'+h+'"','ng-show="itm.'+m+'">','<div ivh-treeview-node-hook class="ivh-treeview-node">','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-right glyphicon glyphicon-chevron-right"></span>','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-down glyphicon glyphicon-chevron-down"></span>','<span class="ivh-treeview-toggle ivh-treeview-toggle-leaf">&#9679;</span>',n?q:"",'<span ivh-treeview-node-toggle="true" class="ivh-treeview-node-label">',"{{itm."+i+"}}","</span>","</div>","<div","ivh-treeview=\"itm['"+j+"']\"",'ivh-treeview-parent="itm"',h?'ivh-treeview-filter="'+h+'"':"",'ivh-treeview-label-attribute="'+i+'"','ivh-treeview-children-attribute="'+j+'"','ivh-treeview-selected-attribute="'+k+'"','ivh-treeview-visible-attribute="'+m+'"','ivh-treeview-use-checkboxes="'+n+'"',"></div>","</li>","</ul>"].join("\n"),s=function(){var b=o();if(b&&b.length){var e=a(r)(c);d.html("").append(e)}};c.$watch(e.ivhTreeview,s),c.$on("event_ivhTreeviewSelectAll",function(a,b){var c=(o(),p());angular.forEach(o(),function(a){a[k]=b,a[l]=!1}),c&&(c[k]=b,c[l]=!1)}),c.$on("event_ivhTreeviewValidate",function(){var a=o(),b=p(),c=a.length,d=0,e=0;a&&a.length&&b&&(angular.forEach(a,function(a){a[k]&&d++,a[l]&&e++}),0===d?(b[k]=!1,b[l]=!!e):d===c?(b[k]=!0,b[l]=!1):(b[k]=!1,b[l]=!0))})}}}]),angular.module("ivh.treeview").provider("ivhTreeviewSettings",function(){"use strict";var a={labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandByDefaultDepth:0,useCheckboxes:!0,indeterminateAttribute:"__ivhTreeviewIntermediate",visibleAttribute:"__ivhTreeviewVisible"};this.set=function(b){angular.extend(a,b)},this.$get=function(){return{get:function(){return angular.copy(a)}}}});