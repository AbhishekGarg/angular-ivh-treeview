angular.module("ivh.treeview",[]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",[function(){"use strict";return{link:function(a,b,c){var d=a[c.ivhTreeviewCheckbox],e=(a[c.ivhTreeviewParent],c.ivhTreeviewIndeterminateAttribute),f=c.ivhTreeviewSelectedAttribute,g=function(){d[e]=!1};b.bind("click",function(){g()}),a.$on("event_ivhTreeviewSelectAll",g),a.$watch(function(){return d[e]},function(){b.prop("indeterminate",d[e])}),a.$watch(function(){return d[f]},function(b){angular.isUndefined(b)||(d[e]||a.$broadcast("event_ivhTreeviewSelectAll",d[f]),a.$parent.$emit("event_ivhTreeviewValidate"))})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNode",["$compile",function(){"use strict";return{restrict:"A",link:function(a,b,c){var d=c.ivhTreeviewNode,e=c.ivhTreeviewFilter,f=c.ivhTreeviewNodeVisibleAttribute,g=a.$eval(c.ivhTreeviewNode);if(!e||"undefined"===e)return void(g[f]=!0);var h=Array.prototype.map||function(a){var b=[];return angular.forEach(this,function(c){b.push(a(c))}),b},i=h.call(e.split("|"),function(a){var b=a.split(":");return b}),j=[];angular.forEach(i,function(a){Array.prototype.push.apply(j,a.slice(1))});var k="["+d+"] | "+e,l=function(){var b=a.$eval(k);g[f]=b.length>0};angular.forEach(j,function(b){a.$watch(b,l)})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNodeToggle",[function(){"use strict";return{restrict:"A",link:function(a,b,c){for(var d=(a.$eval(c.ivhTreeviewNodeToggle),b.parent());d&&"LI"!==d.prop("nodeName");)d=d.parent();b.bind("click",function(){d.hasClass("ivh-treeview-node-leaf")||d.toggleClass("ivh-treeview-node-collapsed")})}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["$compile","$filter","ivhTreeviewSettings",function(a,b,c){"use strict";return{restrict:"A",link:function(d,e,f){var g=c.get(),h=f.ivhTreeview,i=f.ivhTreeviewFilter,j=d.$eval(f.ivhTreeviewDepth)||0,k=d.$eval(f.ivhTreeviewExpandToDepth)||0,l=d.$eval(f.ivhTreeviewLabelAttribute)||g.labelAttribute,m=d.$eval(f.ivhTreeviewChildrenAttribute)||g.childrenAttribute,n=d.$eval(f.ivhTreeviewSelectedAttribute)||g.selectedAttribute,o=f.ivhTreeviewIndeterminateAttribute||g.indeterminateAttribute,p=f.ivhTreeviewVisibleAttribute||g.visibleAttribute,q=angular.isDefined(f.ivhTreeviewUseCheckboxes)?d.$eval(f.ivhTreeviewUseCheckboxes):g.useCheckboxes,r=b("ivhTreeviewAsArray");k=-1===k?1/0:k;var s=function(){return r(d.$eval(h))},t=function(){return d[f.ivhTreeviewParent]},u=["<input",'ivh-treeview-checkbox="itm"','ivh-treeview-indeterminate-attribute="'+o+'"','ivh-treeview-selected-attribute="'+n+'"','ivh-treeview-parent="'+f.ivhTreeviewParent+'"','class="ivh-treeview-checkbox"','type="checkbox"',"ng-model=\"itm['"+n+"']\" />"].join("\n"),v=['<ul class="ivh-treeview">','<li ng-repeat="itm in '+h+' | ivhTreeviewAsArray"',"title=\"{{itm['"+l+"']}}\"","ng-class=\"{'ivh-treeview-node-leaf': !itm['"+m+"'].length"+(j>=k?", 'ivh-treeview-node-collapsed': itm['"+m+"'].length > 1":"")+'}"','ivh-treeview-node="itm"','ivh-treeview-node-visible-attribute="'+p+'"','ivh-treeview-node-selected-attribute="'+n+'"','ivh-treeview-node-hook="itm"','ivh-treeview-filter="'+i+'"','ng-show="itm.'+p+'">','<div ivh-treeview-node-hook class="ivh-treeview-node">','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-right glyphicon glyphicon-chevron-right"></span>','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-down glyphicon glyphicon-chevron-down"></span>','<span class="ivh-treeview-toggle ivh-treeview-toggle-leaf">&#9679;</span>',q?u:"",'<span ivh-treeview-node-toggle="true" class="ivh-treeview-node-label">',"{{itm."+l+"}}","</span>","</div>","<div","ivh-treeview=\"itm['"+m+"']\"",'ivh-treeview-parent="itm"',i?'ivh-treeview-filter="'+i+'"':"",'ivh-treeview-label-attribute="'+l+'"','ivh-treeview-children-attribute="'+m+'"','ivh-treeview-selected-attribute="'+n+'"','ivh-treeview-visible-attribute="'+p+'"','ivh-treeview-indeterminate-attribute="'+o+'"','ivh-treeview-use-checkboxes="'+q+'"','ivh-treeview-depth="'+(1+j)+'"','ivh-treeview-expand-to-depth="'+k+'"',"></div>","</li>","</ul>"].join("\n"),w=function(){var b=s();if(b&&b.length){var c=a(v)(d);e.html("").append(c)}};d.$watch(f.ivhTreeview,w),d.$on("event_ivhTreeviewSelectAll",function(a,b){var c=s(),d=t();angular.forEach(c,function(a){a[n]=b,a[o]=!1}),d&&(d[n]=b,d[o]=!1)}),d.$on("event_ivhTreeviewValidate",function(){var a=s(),b=t(),c=a.length,d=0,e=0;a&&a.length&&b&&(angular.forEach(a,function(a){a[n]&&d++,a[o]&&e++}),0===d?(b[n]=!1,b[o]=!!e):d===c?(b[n]=!0,b[o]=!1):(b[n]=!1,b[o]=!0))})}}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(a){return!angular.isArray(a)&&angular.isObject(a)?[a]:a}}),angular.module("ivh.treeview").provider("ivhTreeviewSettings",function(){"use strict";var a={labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandToDepth:0,useCheckboxes:!0,indeterminateAttribute:"__ivhTreeviewIndeterminate",visibleAttribute:"__ivhTreeviewVisible"};this.set=function(b){angular.extend(a,b)},this.$get=function(){return{get:function(){return angular.copy(a)}}}});