angular.module("ivh.treeview",[]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",[function(){"use strict";return{link:function(a,b,c){var d=a[c.ivhTreeviewCheckbox],e=(a[c.ivhTreeviewParent],c.ivhTreeviewIndeterminateAttribute),f=c.ivhTreeviewSelectedAttribute,g=function(){d[e]=!1};b.bind("click",function(){g()}),a.$on("event_ivhTreeviewSelectAll",g),a.$watch(function(){return d[e]},function(){b.prop("indeterminate",d[e])}),a.$watch(function(){return d[f]},function(b){angular.isUndefined(b)||(d[e]||a.$broadcast("event_ivhTreeviewSelectAll",d[f]),a.$parent.$emit("event_ivhTreeviewValidate"))})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNode",["$compile",function(){"use strict";return{restrict:"A",link:function(a,b,c){var d=c.ivhTreeviewNode,e=c.ivhTreeviewFilter,f=c.ivhTreeviewNodeVisibleAttribute,g=a.$eval(c.ivhTreeviewNode);if(!e||"undefined"===e)return void(g[f]=!0);var h=Array.prototype.map||function(a){var b=[];return angular.forEach(this,function(c){b.push(a(c))}),b},i=h.call(e.split("|"),function(a){var b=a.split(":");return b}),j=[];angular.forEach(i,function(a){Array.prototype.push.apply(j,a.slice(1))});var k="["+d+"] | "+e,l=function(){var b=a.$eval(k);g[f]=b.length>0};angular.forEach(j,function(b){a.$watch(b,l)})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewNodeToggle",[function(){"use strict";return{restrict:"A",link:function(a,b,c){for(var d=(a.$eval(c.ivhTreeviewNodeToggle),b.parent());d&&"LI"!==d.prop("nodeName");)d=d.parent();b.bind("click",function(){d.hasClass("ivh-treeview-node-leaf")||d.toggleClass("ivh-treeview-node-collapsed")})}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["$compile","$filter","ivhTreeviewOptions",function(a,b,c){"use strict";return{restrict:"A",link:function(d,e,f){var g=c(),h=f.ivhTreeview,i=f.ivhTreeviewFilter,j=d.$eval(f.ivhTreeviewDepth)||0,k=d.$eval(f.ivhTreeviewExpandToDepth)||0,l=d.$eval(f.ivhTreeviewLabelAttribute)||g.labelAttribute,m=d.$eval(f.ivhTreeviewChildrenAttribute)||g.childrenAttribute,n=d.$eval(f.ivhTreeviewSelectedAttribute)||g.selectedAttribute,o=f.ivhTreeviewIndeterminateAttribute||g.indeterminateAttribute,p=f.ivhTreeviewVisibleAttribute||g.visibleAttribute,q=angular.isDefined(f.ivhTreeviewUseCheckboxes)?d.$eval(f.ivhTreeviewUseCheckboxes):g.useCheckboxes,r=b("ivhTreeviewAsArray");k=-1===k?1/0:k;var s=function(){return r(d.$eval(h))},t=function(){return d[f.ivhTreeviewParent]},u=["<input",'ivh-treeview-checkbox="itm"','ivh-treeview-indeterminate-attribute="'+o+'"','ivh-treeview-selected-attribute="'+n+'"','ivh-treeview-parent="'+f.ivhTreeviewParent+'"','class="ivh-treeview-checkbox"','type="checkbox"',"ng-model=\"itm['"+n+"']\" />"].join("\n"),v=['<ul class="ivh-treeview">','<li ng-repeat="itm in '+h+' | ivhTreeviewAsArray"',"title=\"{{itm['"+l+"']}}\"","ng-class=\"{'ivh-treeview-node-leaf': !itm['"+m+"'].length"+(j>=k?", 'ivh-treeview-node-collapsed': itm['"+m+"'].length > 1":"")+'}"','ivh-treeview-node="itm"','ivh-treeview-node-visible-attribute="'+p+'"','ivh-treeview-node-selected-attribute="'+n+'"','ivh-treeview-node-hook="itm"','ivh-treeview-filter="'+i+'"','ng-show="itm.'+p+'">','<div ivh-treeview-node-hook class="ivh-treeview-node">','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-right glyphicon glyphicon-chevron-right"></span>','<span ivh-treeview-node-toggle class="ivh-treeview-toggle ivh-treeview-toggle-down glyphicon glyphicon-chevron-down"></span>','<span class="ivh-treeview-toggle ivh-treeview-toggle-leaf">&#9679;</span>',q?u:"",'<span ivh-treeview-node-toggle="true" class="ivh-treeview-node-label">',"{{itm."+l+"}}","</span>","</div>","<div","ivh-treeview=\"itm['"+m+"']\"",'ivh-treeview-parent="itm"',i?'ivh-treeview-filter="'+i+'"':"",'ivh-treeview-label-attribute="'+l+'"','ivh-treeview-children-attribute="'+m+'"','ivh-treeview-selected-attribute="'+n+'"','ivh-treeview-visible-attribute="'+p+'"','ivh-treeview-indeterminate-attribute="'+o+'"','ivh-treeview-use-checkboxes="'+q+'"','ivh-treeview-depth="'+(1+j)+'"','ivh-treeview-expand-to-depth="'+k+'"',"></div>","</li>","</ul>"].join("\n"),w=function(){var b=s();if(b&&b.length){var c=a(v)(d);e.html("").append(c)}};d.$watch(f.ivhTreeview,w),d.$on("event_ivhTreeviewSelectAll",function(a,b){var c=s(),d=t();angular.forEach(c,function(a){a[n]=b,a[o]=!1}),d&&(d[n]=b,d[o]=!1)}),d.$on("event_ivhTreeviewValidate",function(){var a=s(),b=t(),c=a.length,d=0,e=0;a&&a.length&&b&&(angular.forEach(a,function(a){a[n]&&d++,a[o]&&e++}),0===d?(b[n]=!1,b[o]=!!e):d===c?(b[n]=!0,b[o]=!1):(b[n]=!1,b[o]=!0))})}}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(a){return!angular.isArray(a)&&angular.isObject(a)?[a]:a}}),angular.module("ivh.treeview").factory("ivhTreeviewBfs",["ivhTreeviewOptions",function(a){"use strict";var b=angular;return function(c,d,e){2===arguments.length&&b.isFunction(d)&&(e=d,d={}),d=angular.extend({},a(),d),e=e||b.noop;var f,g,h,i,j,k=[],l=d.childrenAttribute;for(b.isArray(c)?(b.forEach(c,function(a){k.push([a,[]])}),f=k.shift()):f=[c,[]];f;){if(g=f[0],h=f[1],e(g,h)!==!1&&g[l]&&b.isArray(g[l]))for(j=g[l].length,i=0;j>i;i++)k.push([g[l][i],[g].concat(h)]);f=k.shift()}}}]),angular.module("ivh.treeview").factory("ivhTreeviewMgr",["ivhTreeviewOptions","ivhTreeviewBfs",function(a,b){"use strict";var c=angular,d=a(),e={},f=function(a){a[this.selectedAttribute]=!1,a[this.indeterminateAttribute]=!1},g=function(a){a[this.selectedAttribute]=!0,a[this.indeterminateAttribute]=!1},h=function(a){var b=a[this.childrenAttribute],d=this.selectedAttribute,e=this.indeterminateAttribute,f=0,g=0;c.forEach(b,function(a){a[d]?f++:a[e]&&g++}),0===f?(a[d]=!1,a[e]=!1):f===b.length?(a[d]=!0,a[e]=!1):(a[d]=!1,a[e]=!0)};return e.select=function(a,i,j,k){arguments.length>2&&"boolean"==typeof j&&(k=j,j={}),j=c.extend({},d,j),k=c.isDefined(k)?k:!0;var l=angular.isString(i),m=!0,n=j.idAttribute;return b(a,j,function(a,d){var e=m&&(l?i===a[n]:i===a);if(e){m=!1;var o=k?g.bind(j):f.bind(j);b(a,j,o),c.forEach(d,h.bind(j))}return m}),e},e.selectAll=function(a,e,f){arguments.length>1&&"boolean"==typeof e&&(f=e,e={}),e=c.extend({},d,e),f=c.isDefined(f)?f:!0;var g=e.selectedAttribute,h=e.indeterminateAttribute;b(a,e,function(a){a[g]=f,a[h]=!1})},e.deselect=function(a,b,c){return e.select(a,b,c,!1)},e.deselectAll=function(a,b){return e.selectAll(a,b,!1)},e.validate=function(a,f,g){arguments.length>1&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=c.isDefined(g)?g:f.defaultSelectedState;var h=f.selectedAttribute,i=f.indeterminateAttribute;b(a,f,function(b){return c.isDefined(b[h])&&b[h]!==g?(e.select(a,b,f,!g),!1):(b[h]=g,void(b[i]=!1))})},e}]),angular.module("ivh.treeview").provider("ivhTreeviewOptions",function(){"use strict";var a={idAttribute:"id",labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandToDepth:0,useCheckboxes:!0,indeterminateAttribute:"__ivhTreeviewIndeterminate",visibleAttribute:"__ivhTreeviewVisible",defaultSelectedState:!0};this.update=function(b){angular.extend(a,b)},this.$get=function(){return function(){return angular.copy(a)}}});